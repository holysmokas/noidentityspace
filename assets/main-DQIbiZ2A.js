(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const o of r)if(o.type==="childList")for(const a of o.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function s(r){const o={};return r.integrity&&(o.integrity=r.integrity),r.referrerPolicy&&(o.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?o.credentials="include":r.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(r){if(r.ep)return;r.ep=!0;const o=s(r);fetch(r.href,o)}})();const p="https://script.google.com/macros/s/AKfycbwg85E0ehs7RvFxyYTDakkq9eIi_ABBR9N42p7R8FkyimxIfLaGPPz1knR7G3MOFJLvhA/exec",i={MIN_SUBMISSION_TIME_MS:3e3,RATE_LIMIT_MAX:3,RATE_LIMIT_WINDOW_MS:6e4,MAX_NAME_LENGTH:100,MAX_EMAIL_LENGTH:254,MAX_SUBJECT_LENGTH:200,MAX_MESSAGE_LENGTH:5e3,HONEYPOT_FIELD:"website_url",STORAGE_KEY_SUBMISSIONS:"nis_form_submissions",STORAGE_KEY_FORM_LOAD:"nis_form_load_time"},h=new Map;function g(t){const e=Date.now();h.set(t,e);try{const s=JSON.parse(sessionStorage.getItem(i.STORAGE_KEY_FORM_LOAD)||"{}");s[t]=e,sessionStorage.setItem(i.STORAGE_KEY_FORM_LOAD,JSON.stringify(s))}catch{}console.log(`[Security] Form "${t}" initialized at ${e}`)}function b(t,e){const s=y(t);if(!s.valid)return console.warn("[Security] Honeypot triggered"),s;const n=v(e);if(!n.valid)return console.warn("[Security] Time gate triggered"),n;const r=E();if(!r.valid)return console.warn("[Security] Rate limit triggered"),r;const o=T(t);if(!o.valid)return console.warn("[Security] Input validation failed:",o.error),o;const a=w(t);return a.valid?{valid:!0,error:null}:(console.warn("[Security] Spam content detected"),a)}function y(t){const e=t.querySelector(`[name="${i.HONEYPOT_FIELD}"]`);return e&&e.value.trim()!==""?{valid:!1,error:"__SILENT_FAIL__",isBot:!0}:{valid:!0,error:null}}function v(t){let e=h.get(t);if(!e)try{e=JSON.parse(sessionStorage.getItem(i.STORAGE_KEY_FORM_LOAD)||"{}")[t]}catch{return{valid:!0,error:null}}return e?Date.now()-e<i.MIN_SUBMISSION_TIME_MS?{valid:!1,error:"Please take a moment to fill out the form completely.",isBot:!0}:{valid:!0,error:null}:(console.warn("[Security] No load time found for form, allowing submission"),{valid:!0,error:null})}function E(){try{const t=Date.now();let e=JSON.parse(localStorage.getItem(i.STORAGE_KEY_SUBMISSIONS)||"[]");if(e=e.filter(s=>t-s<i.RATE_LIMIT_WINDOW_MS),e.length>=i.RATE_LIMIT_MAX){const s=Math.min(...e);return{valid:!1,error:`Too many submissions. Please wait ${Math.ceil((i.RATE_LIMIT_WINDOW_MS-(t-s))/1e3)} seconds before trying again.`}}return{valid:!0,error:null}}catch{return{valid:!0,error:null}}}function I(){try{const t=Date.now();let e=JSON.parse(localStorage.getItem(i.STORAGE_KEY_SUBMISSIONS)||"[]");e=e.filter(s=>t-s<i.RATE_LIMIT_WINDOW_MS),e.push(t),localStorage.setItem(i.STORAGE_KEY_SUBMISSIONS,JSON.stringify(e))}catch{}}function T(t){const e=new FormData(t);for(const[n,r]of e.entries()){if(n===i.HONEYPOT_FIELD||typeof r!="string")continue;const o={name:i.MAX_NAME_LENGTH,email:i.MAX_EMAIL_LENGTH,subject:i.MAX_SUBJECT_LENGTH,message:i.MAX_MESSAGE_LENGTH};if(o[n]&&r.length>o[n])return{valid:!1,error:`${n.charAt(0).toUpperCase()+n.slice(1)} is too long. Maximum ${o[n]} characters.`};if(M(r))return{valid:!1,error:"Your message contains invalid characters. Please remove any code or special formatting."}}const s=e.get("email");return s&&!A(s)?{valid:!1,error:"Please enter a valid email address."}:{valid:!0,error:null}}function M(t){return[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/<iframe/gi,/<object/gi,/<embed/gi,/<link/gi,/data:/gi,/vbscript:/gi,/expression\s*\(/gi,/url\s*\(\s*['"]?\s*data:/gi].some(s=>s.test(t))}function m(t){if(!t||t.length<6)return!1;const e=t.replace(/[\s\d]/g,"").toLowerCase();if(e.length<6)return!1;const n=(e.match(/[aeiou]/g)||[]).length/e.length;if(n<.2||n>.7||/[bcdfghjklmnpqrstvwxyz]{5,}/i.test(e))return!0;const r=t.replace(/[\s\d]/g,"");if(r.length>=8){let u=0;for(let c=1;c<r.length;c++){const d=r[c-1]===r[c-1].toUpperCase(),_=r[c]===r[c].toUpperCase();d!==_&&u++}if(u/r.length>.5)return!0}const o=["th","he","in","er","an","on","en","at","es","ed","or","ti","is","it","al","ar","st","to","nt","ng"];let a=0;for(const u of o)e.includes(u)&&a++;const l=Math.floor(e.length/5);return e.length>=10&&a<Math.min(l,2)}function w(t){const e=new FormData(t),s=e.get("name")||"",n=e.get("message")||"",r=e.get("subject")||"",o=`${r} ${n}`.toLowerCase(),a=[{test:()=>m(s),reason:"Please enter a valid name"},{test:()=>r&&m(r),reason:"Please enter a valid subject"},{test:()=>n&&n.length<100&&m(n),reason:"Please enter a valid message"},{test:()=>(o.match(/https?:\/\//g)||[]).length>3,reason:"Too many links"},{test:()=>/\b(viagra|casino|lottery|winner|nigerian prince|bitcoin investment|crypto doubler)\b/i.test(o),reason:"Spam content detected"},{test:()=>n.length>50&&n===n.toUpperCase(),reason:"Please avoid using all capital letters"},{test:()=>/(.)\1{10,}/g.test(o),reason:"Invalid content detected"}];for(const l of a)if(l.test())return{valid:!1,error:l.reason};return{valid:!0,error:null}}function A(t){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)&&t.length<=i.MAX_EMAIL_LENGTH}function L(t){return typeof t!="string"?t:t.replace(/\0/g,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").trim()}function O(t){const e=new FormData(t),s=new URLSearchParams;for(const[n,r]of e.entries())n!==i.HONEYPOT_FIELD&&(typeof r=="string"?s.append(n,L(r)):s.append(n,r));return s.append("_timestamp",Date.now().toString()),s.append("_timezone",Intl.DateTimeFormat().resolvedOptions().timeZone||"unknown"),s}function N(){const t=[navigator.language,navigator.platform,screen.width+"x"+screen.height,new Date().getTimezoneOffset()];let e=0;const s=t.join("|");for(let n=0;n<s.length;n++){const r=s.charCodeAt(n);e=(e<<5)-e+r,e=e&e}return Math.abs(e).toString(36)}const F=3;window.toggleMenu=function(){const t=document.getElementById("navLinks");t&&t.classList.toggle("active")};function S(t){t.preventDefault();const e=t.target,s=e.id||"newsletterForm",n=e.querySelector('button[type="submit"]');let r=e.querySelector(".message-box");if(r||(r=document.createElement("div"),r.className="message-box",e.appendChild(r)),!n){console.error("Newsletter submit button not found");return}if(!p.includes("script.google.com")){f(r,n,"Configuration Error: The Apps Script URL has not been set correctly.");return}const o=b(e,s);if(!o.valid){if(o.error==="__SILENT_FAIL__"){C(r,n,e);return}f(r,n,o.error);return}r.style.display="none",r.textContent="",n.disabled=!0,n.textContent="Subscribing...";const a=O(e);a.append("formType","newsletter"),a.append("_fingerprint",N());let l=0;const u=()=>{fetch(p,{method:"POST",body:a}).then(c=>c.text()).then(c=>{if(c==="success")I(),R(r,n,e,s);else throw new Error(`Subscription failed. Response: ${c}`)}).catch(c=>{if(l<F){l++;const d=Math.pow(2,l)*1e3;setTimeout(u,d)}else console.error("Submission Error:",c),f(r,n,"We couldn't subscribe your email. Please try again later.")})};u()}function R(t,e,s,n){t.className="message-box message-success",t.innerHTML="<strong>Success!</strong> You have been subscribed to our newsletter!",t.style.display="block",e.disabled=!1,e.textContent="Subscribe",s.reset(),g(n)}function C(t,e,s,n){t.className="message-box message-success",t.innerHTML="<strong>Success!</strong> You have been subscribed to our newsletter!",t.style.display="block",e.disabled=!1,e.textContent="Subscribe",s.reset(),console.log("[Security] Bot newsletter submission blocked silently")}function f(t,e,s){t.className="message-box message-error",t.innerHTML=`<strong>Error!</strong> ${s}`,t.style.display="block",e.disabled=!1,e.textContent="Subscribe"}function D(){const t=document.getElementById("newsletterForm");t&&(g("newsletterForm"),t.addEventListener("submit",S),console.log("[Security] Main newsletter form initialized"));const e=document.getElementById("sidebarNewsletterForm");e&&(g("sidebarNewsletterForm"),e.addEventListener("submit",S),console.log("[Security] Sidebar newsletter form initialized"))}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",function(e){e.preventDefault();const s=document.querySelector(this.getAttribute("href"));if(s){s.scrollIntoView({behavior:"smooth"});const n=document.getElementById("navLinks");n&&n.classList.remove("active")}})}),D()});export{p as A,N as g,g as i,O as p,I as r,b as v};
