(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))o(n);new MutationObserver(n=>{for(const s of n)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function r(n){const s={};return n.integrity&&(s.integrity=n.integrity),n.referrerPolicy&&(s.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?s.credentials="include":n.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(n){if(n.ep)return;n.ep=!0;const s=r(n);fetch(n.href,s)}})();const f="https://script.google.com/macros/s/AKfycbwg85E0ehs7RvFxyYTDakkq9eIi_ABBR9N42p7R8FkyimxIfLaGPPz1knR7G3MOFJLvhA/exec",i={MIN_SUBMISSION_TIME_MS:3e3,RATE_LIMIT_MAX:3,RATE_LIMIT_WINDOW_MS:6e4,MAX_NAME_LENGTH:100,MAX_EMAIL_LENGTH:254,MAX_SUBJECT_LENGTH:200,MAX_MESSAGE_LENGTH:5e3,HONEYPOT_FIELD:"website_url",STORAGE_KEY_SUBMISSIONS:"nis_form_submissions",STORAGE_KEY_FORM_LOAD:"nis_form_load_time"},p=new Map;function d(t){const e=Date.now();p.set(t,e);try{const r=JSON.parse(sessionStorage.getItem(i.STORAGE_KEY_FORM_LOAD)||"{}");r[t]=e,sessionStorage.setItem(i.STORAGE_KEY_FORM_LOAD,JSON.stringify(r))}catch{}console.log(`[Security] Form "${t}" initialized at ${e}`)}function _(t,e){const r=b(t);if(!r.valid)return console.warn("[Security] Honeypot triggered"),r;const o=y(e);if(!o.valid)return console.warn("[Security] Time gate triggered"),o;const n=h();if(!n.valid)return console.warn("[Security] Rate limit triggered"),n;const s=I(t);if(!s.valid)return console.warn("[Security] Input validation failed:",s.error),s;const a=v(t);return a.valid?{valid:!0,error:null}:(console.warn("[Security] Spam content detected"),a)}function b(t){const e=t.querySelector(`[name="${i.HONEYPOT_FIELD}"]`);return e&&e.value.trim()!==""?{valid:!1,error:"__SILENT_FAIL__",isBot:!0}:{valid:!0,error:null}}function y(t){let e=p.get(t);if(!e)try{e=JSON.parse(sessionStorage.getItem(i.STORAGE_KEY_FORM_LOAD)||"{}")[t]}catch{return{valid:!0,error:null}}return e?Date.now()-e<i.MIN_SUBMISSION_TIME_MS?{valid:!1,error:"Please take a moment to fill out the form completely.",isBot:!0}:{valid:!0,error:null}:(console.warn("[Security] No load time found for form, allowing submission"),{valid:!0,error:null})}function h(){try{const t=Date.now();let e=JSON.parse(localStorage.getItem(i.STORAGE_KEY_SUBMISSIONS)||"[]");if(e=e.filter(r=>t-r<i.RATE_LIMIT_WINDOW_MS),e.length>=i.RATE_LIMIT_MAX){const r=Math.min(...e);return{valid:!1,error:`Too many submissions. Please wait ${Math.ceil((i.RATE_LIMIT_WINDOW_MS-(t-r))/1e3)} seconds before trying again.`}}return{valid:!0,error:null}}catch{return{valid:!0,error:null}}}function E(){try{const t=Date.now();let e=JSON.parse(localStorage.getItem(i.STORAGE_KEY_SUBMISSIONS)||"[]");e=e.filter(r=>t-r<i.RATE_LIMIT_WINDOW_MS),e.push(t),localStorage.setItem(i.STORAGE_KEY_SUBMISSIONS,JSON.stringify(e))}catch{}}function I(t){const e=new FormData(t);for(const[o,n]of e.entries()){if(o===i.HONEYPOT_FIELD||typeof n!="string")continue;const s={name:i.MAX_NAME_LENGTH,email:i.MAX_EMAIL_LENGTH,subject:i.MAX_SUBJECT_LENGTH,message:i.MAX_MESSAGE_LENGTH};if(s[o]&&n.length>s[o])return{valid:!1,error:`${o.charAt(0).toUpperCase()+o.slice(1)} is too long. Maximum ${s[o]} characters.`};if(T(n))return{valid:!1,error:"Your message contains invalid characters. Please remove any code or special formatting."}}const r=e.get("email");return r&&!M(r)?{valid:!1,error:"Please enter a valid email address."}:{valid:!0,error:null}}function T(t){return[/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,/javascript:/gi,/on\w+\s*=/gi,/<iframe/gi,/<object/gi,/<embed/gi,/<link/gi,/data:/gi,/vbscript:/gi,/expression\s*\(/gi,/url\s*\(\s*['"]?\s*data:/gi].some(r=>r.test(t))}function v(t){const e=new FormData(t),r=e.get("message")||"",n=`${e.get("subject")||""} ${r}`.toLowerCase(),s=[{test:()=>(n.match(/https?:\/\//g)||[]).length>3,reason:"Too many links"},{test:()=>/\b(viagra|casino|lottery|winner|nigerian prince|bitcoin investment|crypto doubler)\b/i.test(n),reason:"Spam content detected"},{test:()=>r.length>50&&r===r.toUpperCase(),reason:"Please avoid using all capital letters"},{test:()=>/(.)\1{10,}/g.test(n),reason:"Invalid content detected"}];for(const a of s)if(a.test())return{valid:!1,error:a.reason};return{valid:!0,error:null}}function M(t){return/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(t)&&t.length<=i.MAX_EMAIL_LENGTH}function A(t){return typeof t!="string"?t:t.replace(/\0/g,"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/[\x00-\x08\x0B\x0C\x0E-\x1F\x7F]/g,"").trim()}function L(t){const e=new FormData(t),r=new URLSearchParams;for(const[o,n]of e.entries())o!==i.HONEYPOT_FIELD&&(typeof n=="string"?r.append(o,A(n)):r.append(o,n));return r.append("_timestamp",Date.now().toString()),r.append("_timezone",Intl.DateTimeFormat().resolvedOptions().timeZone||"unknown"),r}function w(){const t=[navigator.language,navigator.platform,screen.width+"x"+screen.height,new Date().getTimezoneOffset()];let e=0;const r=t.join("|");for(let o=0;o<r.length;o++){const n=r.charCodeAt(o);e=(e<<5)-e+n,e=e&e}return Math.abs(e).toString(36)}const O=3;window.toggleMenu=function(){const t=document.getElementById("navLinks");t&&t.classList.toggle("active")};function g(t){t.preventDefault();const e=t.target,r=e.id||"newsletterForm",o=e.querySelector('button[type="submit"]');let n=e.querySelector(".message-box");if(n||(n=document.createElement("div"),n.className="message-box",e.appendChild(n)),!o){console.error("Newsletter submit button not found");return}if(!f.includes("script.google.com")){u(n,o,"Configuration Error: The Apps Script URL has not been set correctly.");return}const s=_(e,r);if(!s.valid){if(s.error==="__SILENT_FAIL__"){F(n,o,e);return}u(n,o,s.error);return}n.style.display="none",n.textContent="",o.disabled=!0,o.textContent="Subscribing...";const a=L(e);a.append("formType","newsletter"),a.append("_fingerprint",w());let l=0;const m=()=>{fetch(f,{method:"POST",body:a}).then(c=>c.text()).then(c=>{if(c==="success")E(),N(n,o,e,r);else throw new Error(`Subscription failed. Response: ${c}`)}).catch(c=>{if(l<O){l++;const S=Math.pow(2,l)*1e3;setTimeout(m,S)}else console.error("Submission Error:",c),u(n,o,"We couldn't subscribe your email. Please try again later.")})};m()}function N(t,e,r,o){t.className="message-box message-success",t.innerHTML="<strong>Success!</strong> You have been subscribed to our newsletter!",t.style.display="block",e.disabled=!1,e.textContent="Subscribe",r.reset(),d(o)}function F(t,e,r,o){t.className="message-box message-success",t.innerHTML="<strong>Success!</strong> You have been subscribed to our newsletter!",t.style.display="block",e.disabled=!1,e.textContent="Subscribe",r.reset(),console.log("[Security] Bot newsletter submission blocked silently")}function u(t,e,r){t.className="message-box message-error",t.innerHTML=`<strong>Error!</strong> ${r}`,t.style.display="block",e.disabled=!1,e.textContent="Subscribe"}function R(){const t=document.getElementById("newsletterForm");t&&(d("newsletterForm"),t.addEventListener("submit",g),console.log("[Security] Main newsletter form initialized"));const e=document.getElementById("sidebarNewsletterForm");e&&(d("sidebarNewsletterForm"),e.addEventListener("submit",g),console.log("[Security] Sidebar newsletter form initialized"))}document.addEventListener("DOMContentLoaded",()=>{document.querySelectorAll('a[href^="#"]').forEach(t=>{t.addEventListener("click",function(e){e.preventDefault();const r=document.querySelector(this.getAttribute("href"));if(r){r.scrollIntoView({behavior:"smooth"});const o=document.getElementById("navLinks");o&&o.classList.remove("active")}})}),R()});export{f as A,w as g,d as i,L as p,E as r,_ as v};
